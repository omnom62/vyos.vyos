---
- debug:
    msg: START vyos_route_maps rendered integration tests on connection={{ ansible_connection }}

- include_tasks: _remove_config.yaml

- block:
    - name: Structure provided configuration into device specific commands
      register: result
      vyos.vyos.vyos_vrf:
        config:
          bind_to_all: true
          instances:
            - name: vrf-green
              description: green-vrf
              disabled: true
              table_id: 105
              vni: 1000
            - name: vrf-amber
              description: amber-vrf
              disable: false
              table_id: 111
              vni: 1001
              address_family:
                - afi: ipv4
                  disable_forwarding: true
                  route_maps:
                    - rm_name: rm1
                      protocol: kernel
                    - rm_name: rm1
                      protocol: ospf
                - afi: ipv6
                  nht_no_resolve_via_default: false
        state: rendered

    - assert:
        that:
          - result.changed == false
          - result.rendered|symmetric_difference(rendered.commands) == []

  always:
    - include_tasks: _remove_config.yaml
